<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Card Popout</title>
<style>
body {
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#fce4ec;
  perspective:1500px;
  font-family:'Segoe UI', sans-serif;
  overflow:hidden;
}

/* Envelope */
.envelope {
  width:250px;
  height:150px;
  position:relative;
  cursor:pointer;
  perspective:1000px;
  transition: opacity 0.5s;
}
.envelope-body {
  width:100%;
  height:100%;
  background:#fff;
  border:2px solid #d6336c;
  border-radius:8px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
  position:relative;
  z-index:1;
  overflow:hidden;
}
.envelope-flap {
  width:0;
  height:0;
  border-left:125px solid transparent;
  border-right:125px solid transparent;
  border-top:75px solid #d6336c;
  position:absolute;
  top:0;
  left:0;
  z-index:2;
  transform-origin:top center;
  transition: transform 1s;
}
/* Card inside envelope */
.envelope .card {
  width:220px;
  height:100px;
  background:#fff8dc;
  position:absolute;
  top:50px;
  left:15px;
  border-radius:6px;
  box-shadow:0 3px 10px rgba(0,0,0,0.2);
  transition: transform 1s;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:1.2rem;
  color:#d6336c;
}

/* Open state */
.envelope.open .envelope-flap {
  transform: rotateX(-180deg); /* flap flips up */
}
.envelope.open .card {
  transform: translateY(-30px);
}

/* Two-page card attached with 3D effect */
.cardContainer {
  width:500px;
  height:280px;
  display:flex;
  gap:0;
  position:absolute;
  top:50%;
  left:50%;
  transform-style: preserve-3d;
  transform: translate(-50%, -50%) translateY(0px) scale(0.1) rotateX(-90deg);
  opacity:0;
  transition: transform 2s ease, opacity 2s ease;
  z-index:3;
  perspective:1500px;
}
.cardContainer.show {
  transform: translate(-50%, -50%) translateY(-50px) scale(1) rotateX(0deg);
  opacity:1;
}
.page {
  width:250px;
  height:280px;
  border-radius:0;
  padding:20px;
  box-shadow:0 15px 25px rgba(0,0,0,0.2);
  position:relative;
  transform-style: preserve-3d;
  transition: transform 0.5s;
}
.leftPage {
  transform-origin: left center;
  background: linear-gradient(145deg,#ffe0b2,#ffd54f);
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:6px;
  font-size:18px;
  font-weight:500;
  color:#5d4037;
  text-shadow:0 1px 2px rgba(0,0,0,0.2);
  position:relative;
  overflow:hidden;
}
.rightPage {
  transform-origin: right center;
  background: linear-gradient(145deg,#ffccbc,#ff8a65);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:6px;
  padding:20px;
  font-size:18px;
  font-weight:500;
  color:#5d4037;
  text-shadow:0 1px 2px rgba(0,0,0,0.2);
  position:relative;
  overflow:hidden;
}
.page:hover {
  transform: rotateY(10deg) rotateX(5deg);
}

/* Cake container */
.cakeContainer {
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  position:absolute;
  top:50%;
  left:50%;
  transform: translate(-50%, -50%);
  z-index:4;
}
.cake {
  position:relative;
  width:180px;
  height:100px;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  margin-top:30px;
}
.cake-base {
  width:100%;
  height:60%;
  background: linear-gradient(to bottom, #4e342e, #3e2723);
  border-radius:10px;
  box-shadow: inset -2px -2px 6px rgba(0,0,0,0.3);
  position:relative;
  z-index:1;
}
.cake-top {
  width:100%;
  height:40%;
  background: linear-gradient(to top, #5d4037, #6d4c41);
  border-radius: 50% 50% 0 0;
  position:absolute;
  top:0;
  left:0;
  box-shadow: inset 0 2px 4px rgba(255,255,255,0.15);
  z-index:2;
}
.candle {
  width:10px;
  height:40px;
  background:#fff;
  position:absolute;
  top:-30px;
  border-radius:3px;
}
.candle:nth-child(3) { left:10%; }
.candle:nth-child(4) { left:30%; }
.candle:nth-child(5) { left:50%; }
.candle:nth-child(6) { left:65%; }
.candle:nth-child(7) { left:85%; }
.flame {
  width:12px;
  height:18px;
  background: radial-gradient(circle,#ffeb3b 0%,#ff9800 70%,transparent 100%);
  border-radius:50%;
  position:absolute;
  top:-18px;
  left:-1px;
  animation:flicker 0.2s infinite alternate;
  transition: opacity 0.5s, transform 0.5s;
}
.flame.blown {
  opacity:0;
  transform: scale(0);
}
@keyframes flicker { from{transform:scale(1);} to{transform:scale(1.2);} }

/* Balloons rising on cake */
.balloonsContainer {
  position:absolute;
  width:100%;
  height:100%;
  top:0;
  left:0;
  pointer-events:none;
  z-index:5;
}
.balloon {
  width:25px;
  height:40px;
  border-radius:50%;
  position:absolute;
  bottom:0;
  animation: rise 6s linear infinite;
}
.balloon::after {
  content:''; width:2px; height:20px; background:#555;
  position:absolute; bottom:-20px; left:50%; transform:translateX(-50%);
}
.balloon:nth-child(1) { left:50px; background:radial-gradient(circle at 30% 30%,#ff4081,#f50057); animation-duration:6s; }
.balloon:nth-child(2) { left:130px; background:radial-gradient(circle at 30% 30%,#03a9f4,#0288d1); animation-duration:7s; }

@keyframes rise {
  0% { transform: translateY(0); opacity:1; }
  80% { opacity:1; }
  100% { transform: translateY(-400px); opacity:0; }
}

/* Blow candles text */
#blowText {
  display:none;
  margin-top:20px;
  font-size:1.2rem;
  color:#d6336c;
  cursor:pointer;
  text-decoration:underline;
}
</style>
</head>
<body>

<!-- Envelope -->
<div class="envelope" id="envelope">
  <div class="envelope-body"></div>
  <div class="envelope-flap"></div>
  <div class="card">Happy Birthday!</div>

    <!-- Message on the envelope -->
  <div style="
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(45%, 40%);
    font-family:'Segoe UI', sans-serif;
    font-size:1rem;
    color:#ff0077;
    text-align:center;
    z-index:3;
    pointer-events:none;
  ">
    To Dinni,<br>
    From Bunnu
  </div>
</div>

<!-- Two-page card -->
<div class="cardContainer" id="cardContainer">
  <div class="page leftPage">
    <p>ðŸŽ‰ Happy Birthday Dinni! ðŸŽ‰</p>
    <p>Wishing you a day full of laughter,
    joy, and wonderful surprises!
    May all your dreams come true!</p>
  </div>
  <div class="page rightPage">
    <p>Enjoy every moment with friends and family!
    Have fun and celebrate big!
    Cheers to you! ðŸ¥³</p>
    <p id="blowText">Blow the Candles!</p>
  </div>
</div>

<!-- Cake container -->
<div class="cakeContainer" id="cakeContainer">
  <div class="cake">
    <div class="cake-base"></div>
    <div class="cake-top"></div>
    <div class="candle"><div class="flame"></div></div>
    <div class="candle"><div class="flame"></div></div>
    <div class="candle"><div class="flame"></div></div>
    <div class="candle"><div class="flame"></div></div>
    <div class="candle"><div class="flame"></div></div>

    <!-- Balloons rising -->
    <div class="balloonsContainer">
      <div class="balloon"></div>
      <div class="balloon"></div>
    </div>
  </div>

  <!-- Microphone button -->
  <button id="micButton" style="margin-top:20px; padding:10px 20px; font-size:1rem; cursor:pointer; display:none; color:#fff; background:#d6336c; border:none; border-radius:5px;">
   Click her and blow on the speaker
  </button>
</div>

<!-- Audio -->
<audio id="birthdayAudio" src="happy-birthday-334876.m4a"></audio>

<script>
const envelope = document.getElementById('envelope');
const cardContainer = document.getElementById('cardContainer');
const cakeContainer = document.getElementById('cakeContainer');
const blowText = document.getElementById('blowText');
const micButton = document.getElementById('micButton');
const birthdayAudio = document.getElementById('birthdayAudio');

let step = 0;

envelope.addEventListener('click', () => {
  if(step === 0){
    envelope.classList.add('open');
    step = 1;
  } else if(step === 1){
    cardContainer.classList.add('show');
    envelope.style.opacity='0';
    setTimeout(() => envelope.style.display='none',500);

    // Show cake after 7.5s
    setTimeout(() => {
      cardContainer.style.display='none';
      cakeContainer.style.display='flex';
      blowText.style.display='block';
      micButton.style.display = 'inline-block';

      // Play Happy Birthday song
      birthdayAudio.play();
    },7500);
    step = 2;
  }
});

blowText.addEventListener('click', () => {
  const flames = document.querySelectorAll('.flame');
  flames.forEach(f => f.classList.add('blown'));
  blowText.style.display = 'none';
});

// Microphone blowing detection
micButton.addEventListener('click', async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioCtx.createMediaStreamSource(stream);
    const analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    source.connect(analyser);
    const dataArray = new Uint8Array(analyser.frequencyBinCount);

    micButton.style.display = 'none';

    function detectBlow() {
      analyser.getByteFrequencyData(dataArray);
      let sum = 0;
      for (let i = 0; i < dataArray.length; i++) sum += dataArray[i];
      let avg = sum / dataArray.length;
      // threshold to detect blowing
      if(avg > 50){ 
        const flames = document.querySelectorAll('.flame');
        flames.forEach(f => f.classList.add('blown'));
        return; // stop after blowing
      }
      requestAnimationFrame(detectBlow);
    }
    detectBlow();
  } catch (err) {
    alert("Microphone permission denied or not available.");
  }
});
</script>

</body>
</html>



